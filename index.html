<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Barber's Money - Login</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&amp;family=Rajdhani:wght@400;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Rajdhani', sans-serif;
    }
    
    ::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }
    
    ::-webkit-scrollbar-track {
      background: linear-gradient(180deg, #000000, #18181b);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #f59e0b, #eab308);
      border-radius: 10px;
      border: 2px solid #18181b;
      box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #fbbf24, #facc15);
      box-shadow: 0 0 15px rgba(251, 191, 36, 0.8);
    }
    
    * {
      scrollbar-width: thin;
      scrollbar-color: #f59e0b #18181b;
    }
    
    .title-font {
      font-family: 'Orbitron', sans-serif;
      letter-spacing: 3px;
    }
    
    .card-shine {
      position: relative;
      overflow: hidden;
    }
    
    .card-shine::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.1), transparent);
      transition: left 0.5s;
    }
    
    .card-shine:hover::before {
      left: 100%;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }
    
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
    
    @media (max-width: 768px) {
      .title-font {
        font-size: 1.75rem;
        letter-spacing: 1.5px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gradient-to-br from-black via-zinc-950 to-black text-white h-full overflow-auto">
  <div id="root" class="w-full min-h-full"></div>
  <script>
    // ESTADO GLOBAL
    let state = {
      isAuthenticated: false,
      currentUser: null,
      currentView: 'caixa',
      allData: [],
      config: { businessName: 'Minha Barbearia', cnpj: '' },
      professionals: [],
      services: [],
      appointments: [],
      costs: [],
      users: []
    };

    // HANDLER DO DATA SDK
    const handler = {
      onDataChanged(records) {
        state.allData = records;
        processRecords(records);
        renderApp();
      }
    };

    // PROCESSAR REGISTROS
    function processRecords(records) {
      const configRec = records.find(r => r.type === 'config');
      if (configRec) {
        state.config = {
          businessName: configRec.businessName || 'Minha Barbearia',
          cnpj: configRec.cnpj || ''
        };
      }

      state.professionals = records
        .filter(r => r.type === 'professional')
        .map(r => ({
          id: r.professionalId,
          name: r.professionalName,
          commission: r.professionalCommission,
          _record: r
        }));

      state.services = records
        .filter(r => r.type === 'service')
        .map(r => ({
          id: r.serviceId,
          name: r.serviceName,
          price: r.servicePrice,
          _record: r
        }));

      state.appointments = records
        .filter(r => r.type === 'appointment')
        .map(r => ({
          id: r.appointmentId,
          date: r.appointmentDate,
          time: r.appointmentTime,
          professionalId: r.appointmentProfessionalId,
          professionalName: r.appointmentProfessionalName,
          serviceId: r.appointmentServiceId,
          serviceName: r.appointmentServiceName,
          value: r.appointmentValue,
          status: r.appointmentStatus,
          _record: r
        }));

      state.costs = records
        .filter(r => r.type === 'cost')
        .map(r => ({
          id: r.costId,
          category: r.costCategory,
          month: r.costMonth,
          value: r.costValue,
          _record: r
        }));

      state.users = records
        .filter(r => r.type === 'user')
        .map(r => ({
          id: r.userId,
          email: r.userEmail,
          password: r.userPassword,
          createdAt: r.userCreatedAt,
          _record: r
        }));
    }

    // DETECTAR SE EST√Å NO AMBIENTE CANVA OU EXTERNO
    const isCanvaEnvironment = typeof window.dataSdk !== 'undefined';
    
    // STORAGE LOCAL (para quando n√£o estiver no Canva)
    const LocalStorage = {
      save(key, data) {
        localStorage.setItem(key, JSON.stringify(data));
      },
      load(key) {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : [];
      }
    };
    
    // INICIALIZAR SDK OU LOCALSTORAGE
    async function init() {
      if (isCanvaEnvironment) {
        // Ambiente Canva - usar Data SDK
        const result = await window.dataSdk.init(handler);
        if (!result.isOk) {
          showMessage('Erro ao inicializar sistema', 'error');
          return;
        }
        
        await new Promise(resolve => setTimeout(resolve, 100));
        
        // Criar servi√ßos padr√£o se n√£o existirem
        if (state.services.length === 0) {
          const defaultServices = [
            { name: 'Corte', price: 35.00 },
            { name: 'Barba', price: 25.00 },
            { name: 'Sobrancelha', price: 15.00 },
            { name: 'Corte + Barba', price: 55.00 },
            { name: 'Pigmenta√ß√£o', price: 45.00 }
          ];
          
          for (const svc of defaultServices) {
            if (state.allData.length < 999) {
              await window.dataSdk.create({
                type: 'service',
                serviceId: 'svc_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                serviceName: svc.name,
                servicePrice: svc.price
              });
              await new Promise(resolve => setTimeout(resolve, 50));
            }
          }
        }
      } else {
        // Ambiente externo - usar localStorage
        const savedData = LocalStorage.load('barbersData');
        
        // Criar servi√ßos padr√£o se n√£o existirem
        if (savedData.length === 0) {
          const defaultServices = [
            { name: 'Corte', price: 35.00 },
            { name: 'Barba', price: 25.00 },
            { name: 'Sobrancelha', price: 15.00 },
            { name: 'Corte + Barba', price: 55.00 },
            { name: 'Pigmenta√ß√£o', price: 45.00 }
          ];
          
          for (const svc of defaultServices) {
            savedData.push({
              __backendId: 'svc_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
              type: 'service',
              serviceId: 'svc_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
              serviceName: svc.name,
              servicePrice: svc.price
            });
            await new Promise(resolve => setTimeout(resolve, 10));
          }
          LocalStorage.save('barbersData', savedData);
        }
        
        processRecords(savedData);
        renderApp();
      }
    }

    // FUN√á√ïES DE UI
    function showMessage(text, type = 'success') {
      const msg = document.createElement('div');
      msg.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-xl z-50 ${
        type === 'success' ? 'bg-emerald-600' : 'bg-red-600'
      } text-white font-semibold animate-fade-in`;
      msg.textContent = text;
      document.body.appendChild(msg);
      setTimeout(() => msg.remove(), 3000);
    }

    function showLoader(show) {
      const existing = document.getElementById('loader');
      if (existing) existing.remove();

      if (show) {
        const loader = document.createElement('div');
        loader.id = 'loader';
        loader.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-50';
        loader.innerHTML = '<div class="w-12 h-12 border-4 border-amber-500 border-t-transparent rounded-full animate-spin"></div>';
        document.body.appendChild(loader);
      }
    }

    function showModal(title, content, onConfirm) {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4';
      modal.innerHTML = `
        <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 max-w-md w-full shadow-2xl border border-zinc-800">
          <h3 class="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-amber-500">${title}</h3>
          <div class="mb-4 sm:mb-6 text-sm sm:text-base">${content}</div>
          <div class="flex gap-2 sm:gap-3 justify-end">
            <button onclick="this.closest('.fixed').remove()" 
              class="px-4 sm:px-5 py-2 text-sm sm:text-base bg-black rounded-lg border border-zinc-800 hover:bg-zinc-800 transition font-semibold">
              Cancelar
            </button>
            <button onclick="modalConfirm()" 
              class="px-4 sm:px-5 py-2 text-sm sm:text-base bg-amber-500 text-black rounded-lg hover:bg-amber-400 transition font-bold">
              Confirmar
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      
      window.modalConfirm = () => {
        modal.remove();
        onConfirm();
      };
    }

    // FUN√á√ïES DE AUTENTICA√á√ÉO
    async function handleLogin(email, password) {
      const user = state.users.find(u => u.email === email && u.password === password);
      
      if (user) {
        state.isAuthenticated = true;
        state.currentUser = user;
        showMessage('Login realizado com sucesso!');
        renderApp();
        return true;
      }
      
      return false;
    }

    async function handleRegister(email, password) {
      if (isCanvaEnvironment) {
        if (state.allData.length >= 999) {
          showMessage('Limite de registros atingido!', 'error');
          return false;
        }

        const existingUser = state.users.find(u => u.email === email);
        if (existingUser) {
          showMessage('Email j√° cadastrado!', 'error');
          return false;
        }

        showLoader(true);
        const result = await window.dataSdk.create({
          type: 'user',
          userId: 'user_' + Date.now(),
          userEmail: email,
          userPassword: password,
          userCreatedAt: new Date().toISOString()
        });
        showLoader(false);

        if (result.isOk) {
          showMessage('Conta criada com sucesso!');
          return true;
        } else {
          showMessage('Erro ao criar conta', 'error');
          return false;
        }
      } else {
        let data = LocalStorage.load('barbersData');
        
        const existingUser = data.find(u => u.type === 'user' && u.userEmail === email);
        if (existingUser) {
          showMessage('Email j√° cadastrado!', 'error');
          return false;
        }
        
        data.push({
          __backendId: 'user_' + Date.now(),
          type: 'user',
          userId: 'user_' + Date.now(),
          userEmail: email,
          userPassword: password,
          userCreatedAt: new Date().toISOString()
        });
        
        LocalStorage.save('barbersData', data);
        processRecords(data);
        showMessage('Conta criada com sucesso!');
        return true;
      }
    }

    function handleLogout() {
      state.isAuthenticated = false;
      state.currentUser = null;
      state.currentView = 'caixa';
      renderApp();
      showMessage('Logout realizado!');
    }

    // EVENT HANDLERS DE LOGIN
    window.handleLoginSubmit = async (e) => {
      e.preventDefault();
      const form = e.target;
      const email = form.email.value;
      const password = form.password.value;

      showLoader(true);
      await new Promise(resolve => setTimeout(resolve, 500));
      const success = await handleLogin(email, password);
      showLoader(false);

      if (!success) {
        showMessage('Email ou senha incorretos!', 'error');
      }
    };

    window.handleRegisterSubmit = async (e) => {
      e.preventDefault();
      const form = e.target;
      const email = form.email.value;
      const password = form.password.value;
      const confirmPassword = form.confirmPassword.value;

      if (password !== confirmPassword) {
        showMessage('As senhas n√£o coincidem!', 'error');
        return;
      }

      if (password.length < 6) {
        showMessage('A senha deve ter pelo menos 6 caracteres!', 'error');
        return;
      }

      const success = await handleRegister(email, password);
      if (success) {
        form.reset();
      }
    };

    window.showLoginForm = () => {
      document.getElementById('login-form').classList.remove('hidden');
      document.getElementById('register-form').classList.add('hidden');
    };

    window.showRegisterForm = () => {
      document.getElementById('login-form').classList.add('hidden');
      document.getElementById('register-form').classList.remove('hidden');
    };

    // A√á√ïES DE DADOS
    async function saveConfig(name, cnpj) {
      if (isCanvaEnvironment) {
        const configRec = state.allData.find(r => r.type === 'config');
        showLoader(true);
        
        let result;
        if (configRec) {
          result = await window.dataSdk.update({
            ...configRec,
            businessName: name,
            cnpj: cnpj
          });
        } else {
          if (state.allData.length >= 999) {
            showLoader(false);
            showMessage('Limite de registros atingido!', 'error');
            return;
          }
          result = await window.dataSdk.create({
            type: 'config',
            businessName: name,
            cnpj: cnpj
          });
        }
        
        showLoader(false);
        if (result.isOk) {
          showMessage('Configura√ß√µes salvas!');
        } else {
          showMessage('Erro ao salvar', 'error');
        }
      } else {
        // LocalStorage
        let data = LocalStorage.load('barbersData');
        const configRec = data.find(r => r.type === 'config');
        
        if (configRec) {
          configRec.businessName = name;
          configRec.cnpj = cnpj;
        } else {
          data.push({
            __backendId: 'config_' + Date.now(),
            type: 'config',
            businessName: name,
            cnpj: cnpj
          });
        }
        
        LocalStorage.save('barbersData', data);
        processRecords(data);
        renderApp();
        showMessage('Configura√ß√µes salvas!');
      }
    }

    async function addProfessional(name, commission) {
      if (isCanvaEnvironment) {
        if (state.allData.length >= 999) {
          showMessage('Limite de 999 registros atingido!', 'error');
          return;
        }
        
        showLoader(true);
        const result = await window.dataSdk.create({
          type: 'professional',
          professionalId: 'prof_' + Date.now(),
          professionalName: name,
          professionalCommission: parseFloat(commission)
        });
        showLoader(false);
        
        if (result.isOk) {
          showMessage('Profissional cadastrado!');
        } else {
          showMessage('Erro ao cadastrar', 'error');
        }
      } else {
        let data = LocalStorage.load('barbersData');
        data.push({
          __backendId: 'prof_' + Date.now(),
          type: 'professional',
          professionalId: 'prof_' + Date.now(),
          professionalName: name,
          professionalCommission: parseFloat(commission)
        });
        LocalStorage.save('barbersData', data);
        processRecords(data);
        renderApp();
        showMessage('Profissional cadastrado!');
      }
    }

    async function deleteProfessional(record) {
      if (isCanvaEnvironment) {
        showLoader(true);
        const result = await window.dataSdk.delete(record);
        showLoader(false);
        
        if (result.isOk) {
          showMessage('Profissional removido!');
        } else {
          showMessage('Erro ao remover', 'error');
        }
      } else {
        let data = LocalStorage.load('barbersData');
        data = data.filter(r => r.__backendId !== record.__backendId);
        LocalStorage.save('barbersData', data);
        processRecords(data);
        renderApp();
        showMessage('Profissional removido!');
      }
    }

    async function updateProfessional(record, name, commission) {
      if (isCanvaEnvironment) {
        showLoader(true);
        const result = await window.dataSdk.update({
          ...record,
          professionalName: name,
          professionalCommission: parseFloat(commission)
        });
        showLoader(false);
        
        if (result.isOk) {
          showMessage('Profissional atualizado!');
        } else {
          showMessage('Erro ao atualizar', 'error');
        }
      } else {
        let data = LocalStorage.load('barbersData');
        const rec = data.find(r => r.__backendId === record.__backendId);
        if (rec) {
          rec.professionalName = name;
          rec.professionalCommission = parseFloat(commission);
        }
        LocalStorage.save('barbersData', data);
        processRecords(data);
        renderApp();
        showMessage('Profissional atualizado!');
      }
    }

    async function addService(name, price) {
      if (isCanvaEnvironment) {
        if (state.allData.length >= 999) {
          showMessage('Limite de 999 registros atingido!', 'error');
          return;
        }
        
        showLoader(true);
        const result = await window.dataSdk.create({
          type: 'service',
          serviceId: 'svc_' + Date.now(),
          serviceName: name,
          servicePrice: parseFloat(price)
        });
        showLoader(false);
        
        if (result.isOk) {
          showMessage('Servi√ßo cadastrado!');
        } else {
          showMessage('Erro ao cadastrar', 'error');
        }
      } else {
        let data = LocalStorage.load('barbersData');
        data.push({
          __backendId: 'svc_' + Date.now(),
          type: 'service',
          serviceId: 'svc_' + Date.now(),
          serviceName: name,
          servicePrice: parseFloat(price)
        });
        LocalStorage.save('barbersData', data);
        processRecords(data);
        renderApp();
        showMessage('Servi√ßo cadastrado!');
      }
    }

    async function deleteService(record) {
      if (isCanvaEnvironment) {
        showLoader(true);
        const result = await window.dataSdk.delete(record);
        showLoader(false);
        
        if (result.isOk) {
          showMessage('Servi√ßo removido!');
        } else {
          showMessage('Erro ao remover', 'error');
        }
      } else {
        let data = LocalStorage.load('barbersData');
        data = data.filter(r => r.__backendId !== record.__backendId);
        LocalStorage.save('barbersData', data);
        processRecords(data);
        renderApp();
        showMessage('Servi√ßo removido!');
      }
    }

    async function updateService(record, name, price) {
      if (isCanvaEnvironment) {
        showLoader(true);
        const result = await window.dataSdk.update({
          ...record,
          serviceName: name,
          servicePrice: parseFloat(price)
        });
        showLoader(false);
        
        if (result.isOk) {
          showMessage('Servi√ßo atualizado!');
        } else {
          showMessage('Erro ao atualizar', 'error');
        }
      } else {
        let data = LocalStorage.load('barbersData');
        const rec = data.find(r => r.__backendId === record.__backendId);
        if (rec) {
          rec.serviceName = name;
          rec.servicePrice = parseFloat(price);
        }
        LocalStorage.save('barbersData', data);
        processRecords(data);
        renderApp();
        showMessage('Servi√ßo atualizado!');
      }
    }

    async function addAppointment(profId, profName, svcId, svcName, value, status) {
      if (isCanvaEnvironment) {
        if (state.allData.length >= 999) {
          showMessage('Limite de 999 registros atingido!', 'error');
          return false;
        }
        
        const now = new Date();
        const date = now.toISOString().split('T')[0];
        const time = now.toTimeString().slice(0, 5);
        
        const result = await window.dataSdk.create({
          type: 'appointment',
          appointmentId: 'apt_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
          appointmentDate: date,
          appointmentTime: time,
          appointmentProfessionalId: profId,
          appointmentProfessionalName: profName,
          appointmentServiceId: svcId,
          appointmentServiceName: svcName,
          appointmentValue: parseFloat(value),
          appointmentStatus: status
        });
        
        return result.isOk;
      } else {
        const now = new Date();
        const date = now.toISOString().split('T')[0];
        const time = now.toTimeString().slice(0, 5);
        
        let data = LocalStorage.load('barbersData');
        data.push({
          __backendId: 'apt_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
          type: 'appointment',
          appointmentId: 'apt_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
          appointmentDate: date,
          appointmentTime: time,
          appointmentProfessionalId: profId,
          appointmentProfessionalName: profName,
          appointmentServiceId: svcId,
          appointmentServiceName: svcName,
          appointmentValue: parseFloat(value),
          appointmentStatus: status
        });
        LocalStorage.save('barbersData', data);
        processRecords(data);
        return true;
      }
    }

    async function deleteAppointment(record) {
      if (isCanvaEnvironment) {
        showLoader(true);
        const result = await window.dataSdk.delete(record);
        showLoader(false);
        
        if (result.isOk) {
          showMessage('Atendimento removido!');
        } else {
          showMessage('Erro ao remover', 'error');
        }
      } else {
        let data = LocalStorage.load('barbersData');
        data = data.filter(r => r.__backendId !== record.__backendId);
        LocalStorage.save('barbersData', data);
        processRecords(data);
        renderApp();
        showMessage('Atendimento removido!');
      }
    }

    async function addCost(category, month, value) {
      if (isCanvaEnvironment) {
        if (state.allData.length >= 999) {
          showMessage('Limite de 999 registros atingido!', 'error');
          return;
        }
        
        showLoader(true);
        const result = await window.dataSdk.create({
          type: 'cost',
          costId: 'cost_' + Date.now(),
          costCategory: category,
          costMonth: month,
          costValue: parseFloat(value)
        });
        showLoader(false);
        
        if (result.isOk) {
          showMessage('Custo registrado!');
        } else {
          showMessage('Erro ao registrar', 'error');
        }
      } else {
        let data = LocalStorage.load('barbersData');
        data.push({
          __backendId: 'cost_' + Date.now(),
          type: 'cost',
          costId: 'cost_' + Date.now(),
          costCategory: category,
          costMonth: month,
          costValue: parseFloat(value)
        });
        LocalStorage.save('barbersData', data);
        processRecords(data);
        renderApp();
        showMessage('Custo registrado!');
      }
    }

    async function deleteCost(record) {
      if (isCanvaEnvironment) {
        showLoader(true);
        const result = await window.dataSdk.delete(record);
        showLoader(false);
        
        if (result.isOk) {
          showMessage('Custo removido!');
        } else {
          showMessage('Erro ao remover', 'error');
        }
      } else {
        let data = LocalStorage.load('barbersData');
        data = data.filter(r => r.__backendId !== record.__backendId);
        LocalStorage.save('barbersData', data);
        processRecords(data);
        renderApp();
        showMessage('Custo removido!');
      }
    }

    // EVENT HANDLERS
    window.changeView = (view) => {
      state.currentView = view;
      renderApp();
    };

    window.handleConfigSubmit = (e) => {
      e.preventDefault();
      const form = e.target;
      saveConfig(form.businessName.value, form.cnpj.value);
    };

    window.handleProfessionalSubmit = (e) => {
      e.preventDefault();
      const form = e.target;
      addProfessional(form.name.value, form.commission.value);
      form.reset();
    };

    window.handleCreateOwner = (e) => {
      e.preventDefault();
      const form = e.target;
      addProfessional(form.ownerName.value, 0);
    };

    window.handleUpdateOwner = (e) => {
      e.preventDefault();
      const form = e.target;
      const owner = state.professionals.find(p => p.commission === 0);
      if (owner) {
        updateProfessional(owner._record, form.ownerName.value, 0);
      }
    };

    window.handleServiceSubmit = (e) => {
      e.preventDefault();
      const form = e.target;
      addService(form.name.value, form.price.value);
      form.reset();
    };

    window.handleCostSubmit = (e) => {
      e.preventDefault();
      const form = e.target;
      addCost(form.category.value, form.month.value, form.value.value);
      form.reset();
    };

    window.confirmDeletePro = (idx) => {
      const prof = state.professionals[idx];
      showModal('Confirmar Exclus√£o', `Remover profissional ${prof.name}?`, () => {
        deleteProfessional(prof._record);
      });
    };

    window.confirmDeleteSvc = (idx) => {
      const svc = state.services[idx];
      showModal('Confirmar Exclus√£o', `Remover servi√ßo ${svc.name}?`, () => {
        deleteService(svc._record);
      });
    };

    window.confirmDeleteApt = (idx) => {
      const apt = state.appointments[idx];
      showModal('Confirmar Exclus√£o', 'Remover este atendimento?', () => {
        deleteAppointment(apt._record);
      });
    };

    window.confirmDeleteCost = (idx) => {
      const cost = state.costs[idx];
      showModal('Confirmar Exclus√£o', `Remover custo de ${cost.category}?`, () => {
        deleteCost(cost._record);
      });
    };

    window.editService = (idx) => {
      const svc = state.services[idx];
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4';
      modal.innerHTML = `
        <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 max-w-md w-full shadow-2xl border border-zinc-800">
          <h3 class="text-xl sm:text-2xl font-bold mb-3 sm:mb-4 text-amber-500">Editar Servi√ßo</h3>
          <form onsubmit="handleEditService(event, ${idx})" class="space-y-3 sm:space-y-4">
            <div>
              <label class="block text-xs sm:text-sm font-semibold mb-1">Nome</label>
              <input type="text" name="name" value="${svc.name}" required
                class="w-full px-3 sm:px-4 py-2 text-sm sm:text-base bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none">
            </div>
            <div>
              <label class="block text-xs sm:text-sm font-semibold mb-1">Valor (R$)</label>
              <input type="number" name="price" step="0.01" value="${svc.price}" required
                class="w-full px-3 sm:px-4 py-2 text-sm sm:text-base bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none">
            </div>
            <div class="flex gap-2 sm:gap-3 justify-end">
              <button type="button" onclick="this.closest('.fixed').remove()" 
                class="px-4 sm:px-5 py-2 text-sm sm:text-base bg-black rounded-lg border border-zinc-800 hover:bg-zinc-800 transition font-semibold">
                Cancelar
              </button>
              <button type="submit" 
                class="px-4 sm:px-5 py-2 text-sm sm:text-base bg-amber-500 text-black rounded-lg hover:bg-amber-400 transition font-bold">
                SALVAR
              </button>
            </div>
          </form>
        </div>
      `;
      document.body.appendChild(modal);
    };

    window.handleEditService = (e, idx) => {
      e.preventDefault();
      const form = e.target;
      const svc = state.services[idx];
      updateService(svc._record, form.name.value, form.price.value);
      form.closest('.fixed').remove();
    };

    window.updateAllProfs = () => {
      const mainProf = document.getElementById('main-prof').value;
      document.querySelectorAll('.line-prof').forEach(input => {
        input.value = mainProf;
      });
    };

    window.updateLineValue = (line) => {
      const select = document.querySelector(`select[name="svc-${line}"]`);
      const option = select.options[select.selectedIndex];
      if (option && option.dataset.price) {
        document.querySelector(`input[name="val-${line}"]`).value = option.dataset.price;
      }
    };

    window.handleSaveMultiple = async (count) => {
      const mainProf = document.getElementById('main-prof').value;
      
      if (!mainProf) {
        showMessage('Selecione o profissional!', 'error');
        return;
      }
      
      const prof = state.professionals.find(p => p.id === mainProf);
      if (!prof) {
        showMessage('Profissional n√£o encontrado!', 'error');
        return;
      }
      
      const linesToSave = [];
      for (let i = 1; i <= count; i++) {
        const svcSelect = document.querySelector(`select[name="svc-${i}"]`);
        const valInput = document.querySelector(`input[name="val-${i}"]`);
        const statusSelect = document.querySelector(`select[name="status-${i}"]`);
        
        if (svcSelect.value && valInput.value && parseFloat(valInput.value) > 0) {
          const svc = state.services.find(s => s.id === svcSelect.value);
          if (svc) {
            linesToSave.push({
              svc: svc,
              value: valInput.value,
              status: statusSelect.value,
              inputs: { svcSelect, valInput, statusSelect }
            });
          }
        }
      }
      
      if (linesToSave.length === 0) {
        showMessage(`Preencha pelo menos a linha 1!`, 'error');
        return;
      }
      
      showLoader(true);
      let success = 0;
      
      for (const line of linesToSave) {
        const ok = await addAppointment(
          prof.id,
          prof.name,
          line.svc.id,
          line.svc.name,
          line.value,
          line.status
        );
        
        if (ok) {
          success++;
          line.inputs.svcSelect.value = '';
          line.inputs.valInput.value = '';
          line.inputs.statusSelect.value = 'Pago';
        }
        
        await new Promise(resolve => setTimeout(resolve, 50));
      }
      
      showLoader(false);
      
      if (success === linesToSave.length) {
        showMessage(`${success} atendimento(s) registrado(s)!`);
      } else {
        showMessage(`${success} de ${linesToSave.length} registrados`, 'error');
      }
    };

    // C√ÅLCULOS
    function getAppointmentsByMonth(month, year) {
      return state.appointments.filter(a => {
        const [y, m] = a.date.split('-');
        return y === year && m === month;
      });
    }

    function getCostsByMonth(month, year) {
      return state.costs.filter(c => {
        const [y, m] = c.month.split('-');
        return y === year && m === month;
      });
    }

    function calcMonthRevenue(month, year) {
      return getAppointmentsByMonth(month, year)
        .reduce((sum, a) => sum + (parseFloat(a.value) || 0), 0);
    }

    function calcMonthCosts(month, year) {
      return getCostsByMonth(month, year)
        .reduce((sum, c) => sum + (parseFloat(c.value) || 0), 0);
    }

    function calcProfitForProfessional(prof, appointments) {
      const revenue = appointments
        .filter(a => a.professionalId === prof.id)
        .reduce((sum, a) => sum + (parseFloat(a.value) || 0), 0);
      
      if (prof.commission === 0) {
        const ownRevenue = revenue;
        const othersRevenue = appointments
          .filter(a => a.professionalId !== prof.id)
          .reduce((sum, a) => sum + (parseFloat(a.value) || 0), 0);
        return ownRevenue + (othersRevenue * 0.5);
      }
      
      return revenue * (prof.commission / 100);
    }

    // RENDERIZA√á√ïES
    function renderLogin() {
      return `
        <div class="min-h-full flex items-center justify-center p-4">
          <div class="w-full max-w-md">
            <!-- T√≠tulo -->
            <div class="text-center mb-8">
              <h1 class="title-font text-4xl sm:text-5xl bg-gradient-to-r from-amber-400 via-yellow-500 to-amber-600 bg-clip-text text-transparent mb-2">
                THE BARBER'S MONEY
              </h1>
              <p class="text-zinc-400 text-sm sm:text-base">Sistema de Gest√£o para Barbearias</p>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="bg-gradient-to-br from-zinc-900 to-black rounded-2xl p-6 sm:p-8 border border-amber-500/20 shadow-2xl card-shine">
              <h2 class="text-2xl font-bold mb-6 text-center text-amber-500">Entrar</h2>
              <form onsubmit="handleLoginSubmit(event)" class="space-y-4">
                <div>
                  <label for="login-email" class="block text-sm font-semibold mb-2">Email</label>
                  <input type="email" id="login-email" name="email" required
                    class="w-full px-4 py-3 bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none transition-all">
                </div>
                <div>
                  <label for="login-password" class="block text-sm font-semibold mb-2">Senha</label>
                  <input type="password" id="login-password" name="password" required
                    class="w-full px-4 py-3 bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none transition-all">
                </div>
                <button type="submit" 
                  class="w-full py-3 bg-gradient-to-r from-amber-500 to-yellow-600 text-black rounded-lg font-black text-lg hover:scale-105 hover:shadow-2xl hover:shadow-amber-500/50 transition-all duration-300">
                  ENTRAR
                </button>
              </form>
              <p class="text-center mt-6 text-sm text-zinc-400">
                N√£o tem uma conta? 
                <button onclick="showRegisterForm()" class="text-amber-500 hover:text-amber-400 font-bold">
                  Criar conta
                </button>
              </p>
            </div>

            <!-- Register Form -->
            <div id="register-form" class="hidden bg-gradient-to-br from-zinc-900 to-black rounded-2xl p-6 sm:p-8 border border-amber-500/20 shadow-2xl card-shine">
              <h2 class="text-2xl font-bold mb-6 text-center text-amber-500">Criar Conta</h2>
              <form onsubmit="handleRegisterSubmit(event)" class="space-y-4">
                <div>
                  <label for="register-email" class="block text-sm font-semibold mb-2">Email</label>
                  <input type="email" id="register-email" name="email" required
                    class="w-full px-4 py-3 bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none transition-all">
                </div>
                <div>
                  <label for="register-password" class="block text-sm font-semibold mb-2">Senha</label>
                  <input type="password" id="register-password" name="password" required minlength="6"
                    class="w-full px-4 py-3 bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none transition-all">
                </div>
                <div>
                  <label for="register-confirm" class="block text-sm font-semibold mb-2">Confirmar Senha</label>
                  <input type="password" id="register-confirm" name="confirmPassword" required minlength="6"
                    class="w-full px-4 py-3 bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none transition-all">
                </div>
                <button type="submit" 
                  class="w-full py-3 bg-gradient-to-r from-amber-500 to-yellow-600 text-black rounded-lg font-black text-lg hover:scale-105 hover:shadow-2xl hover:shadow-amber-500/50 transition-all duration-300">
                  CRIAR CONTA
                </button>
              </form>
              <p class="text-center mt-6 text-sm text-zinc-400">
                J√° tem uma conta? 
                <button onclick="showLoginForm()" class="text-amber-500 hover:text-amber-400 font-bold">
                  Entrar
                </button>
              </p>
            </div>
          </div>
        </div>
      `;
    }

    function renderNav() {
      const views = [
        { id: 'caixa', label: 'üí∞ Caixa' },
        { id: 'historico', label: 'üìã Hist√≥rico' },
        { id: 'relatorios', label: 'üìä Relat√≥rios' },
        { id: 'extrato', label: 'üíµ Extrato' },
        { id: 'custos', label: 'üí∏ Custos' },
        { id: 'servicos', label: '‚úÇÔ∏è Servi√ßos' },
        { id: 'profissionais', label: 'üë• Profissionais' }
      ];

      return `
        <nav class="bg-gradient-to-r from-black via-zinc-900 to-black border-b-2 border-amber-500/30 shadow-2xl">
          <div class="px-4 sm:px-6 py-4">
            <div class="flex justify-between items-center mb-3 sm:mb-4">
              <h1 class="title-font text-2xl sm:text-3xl md:text-4xl bg-gradient-to-r from-amber-400 via-yellow-500 to-amber-600 bg-clip-text text-transparent drop-shadow-lg">
                THE BARBER'S MONEY
              </h1>
              <button onclick="handleLogout()" 
                class="px-3 sm:px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-xs sm:text-sm font-bold transition">
                Sair
              </button>
            </div>
            <div class="flex flex-wrap gap-1.5 sm:gap-2">
              ${views.map(v => `
                <button onclick="changeView('${v.id}')" 
                  class="px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm rounded-lg font-bold whitespace-nowrap transition-all duration-300 ${
                    state.currentView === v.id 
                      ? 'bg-gradient-to-r from-amber-500 to-yellow-600 text-black shadow-lg shadow-amber-500/50 scale-105' 
                      : 'bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 hover:border-amber-500/50 hover:shadow-lg hover:shadow-amber-500/20'
                  }">
                  ${v.label}
                </button>
              `).join('')}
            </div>
          </div>
        </nav>
      `;
    }

    function renderCaixa() {
      const hasProfessionals = state.professionals.length > 0;
      const hasServices = state.services.length > 0;

      return `
        <div class="p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6">
          <div class="bg-gradient-to-br from-zinc-900 to-black rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-amber-500/20 shadow-2xl card-shine">
            <h2 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 bg-gradient-to-r from-amber-400 to-yellow-500 bg-clip-text text-transparent">‚ö° Registro R√°pido</h2>
            
            ${!hasProfessionals ? `
              <div class="bg-yellow-900/20 border-2 border-yellow-600/50 rounded-xl p-3 sm:p-4 mb-4 backdrop-blur-sm">
                <p class="text-yellow-300 font-semibold text-sm sm:text-base">‚ö†Ô∏è Cadastre profissionais na aba "Profissionais"</p>
              </div>
            ` : ''}
            
            ${!hasServices ? `
              <div class="bg-yellow-900/20 border-2 border-yellow-600/50 rounded-xl p-3 sm:p-4 mb-4 backdrop-blur-sm">
                <p class="text-yellow-300 font-semibold text-sm sm:text-base">‚ö†Ô∏è Cadastre servi√ßos abaixo ou na aba "Servi√ßos"</p>
              </div>
            ` : ''}
            
            ${hasProfessionals && hasServices ? `
              <div class="flex gap-2 sm:gap-3 mb-4 sm:mb-6 flex-wrap justify-center sm:justify-start">
                ${[1, 2, 3, 4, 5].map(n => `
                  <button onclick="handleSaveMultiple(${n})" 
                    class="w-14 h-14 sm:w-16 sm:h-16 bg-gradient-to-br from-amber-500 to-yellow-600 text-black rounded-xl font-black text-2xl sm:text-3xl hover:scale-110 hover:shadow-2xl hover:shadow-amber-500/50 transition-all duration-300">
                    ${n}
                  </button>
                `).join('')}
              </div>

              <div class="mb-4 sm:mb-6">
                <label class="block mb-2 font-bold text-base sm:text-lg text-amber-400">Profissional</label>
                <select id="main-prof" onchange="updateAllProfs()"
                  class="w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base bg-black/50 rounded-xl border-2 border-zinc-800 focus:border-amber-500 outline-none font-semibold transition-all">
                  <option value="">Selecione</option>
                  ${state.professionals.map(p => `
                    <option value="${p.id}">${p.name}</option>
                  `).join('')}
                </select>
              </div>

              <div class="space-y-2 sm:space-y-3">
                ${[1, 2, 3, 4, 5].map(i => `
                  <div class="flex gap-2 sm:gap-3 items-center bg-zinc-900/50 p-2 sm:p-3 rounded-xl border border-zinc-800 hover:border-amber-500/30 transition-all flex-wrap sm:flex-nowrap">
                    <span class="text-2xl sm:text-3xl font-black bg-gradient-to-r from-amber-400 to-yellow-500 bg-clip-text text-transparent w-8 sm:w-10">${i}</span>
                    <input type="hidden" class="line-prof">
                    <select name="svc-${i}" onchange="updateLineValue(${i})"
                      class="flex-1 min-w-[150px] px-2 sm:px-3 py-2 text-sm sm:text-base bg-black/70 rounded-lg border border-zinc-700 focus:border-amber-500 outline-none font-semibold transition-all">
                      <option value="">Servi√ßo</option>
                      ${state.services.map(s => `
                        <option value="${s.id}" data-price="${s.price}">${s.name}</option>
                      `).join('')}
                    </select>
                    <input type="number" name="val-${i}" step="0.01" placeholder="R$"
                      class="w-24 sm:w-32 px-2 sm:px-3 py-2 text-sm sm:text-base bg-black/70 rounded-lg border border-zinc-700 focus:border-amber-500 outline-none font-bold text-amber-400 transition-all">
                    <select name="status-${i}"
                      class="w-28 sm:w-36 px-2 sm:px-3 py-2 text-sm sm:text-base bg-black/70 rounded-lg border border-zinc-700 focus:border-amber-500 outline-none font-semibold transition-all">
                      <option value="Pago">Pago</option>
                      <option value="Pendente">Pendente</option>
                    </select>
                  </div>
                `).join('')}
              </div>
            ` : ''}
          </div>

          <div class="bg-gradient-to-br from-zinc-900 to-black rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-amber-500/20 shadow-2xl card-shine">
            <h2 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 bg-gradient-to-r from-amber-400 to-yellow-500 bg-clip-text text-transparent">‚ûï Cadastrar Servi√ßo</h2>
            <form onsubmit="handleServiceSubmit(event)" class="flex gap-2 sm:gap-3 flex-wrap">
              <input type="text" name="name" required placeholder="Nome do Servi√ßo"
                class="flex-1 min-w-[200px] px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base bg-black/50 rounded-xl border-2 border-zinc-800 focus:border-amber-500 outline-none font-semibold transition-all">
              <input type="number" name="price" step="0.01" required placeholder="Valor R$"
                class="w-32 sm:w-36 px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base bg-black/50 rounded-xl border-2 border-zinc-800 focus:border-amber-500 outline-none font-bold text-amber-400 transition-all">
              <button type="submit" 
                class="w-full sm:w-auto px-6 sm:px-8 py-2.5 sm:py-3 text-sm sm:text-base bg-gradient-to-r from-amber-500 to-yellow-600 text-black rounded-xl font-black hover:scale-105 hover:shadow-2xl hover:shadow-amber-500/50 transition-all duration-300">
                SALVAR
              </button>
            </form>
          </div>
        </div>
      `;
    }

    function renderHistorico() {
      const apts = [...state.appointments].reverse();

      return `
        <div class="p-3 sm:p-4 md:p-6">
          <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 border border-zinc-800">
            <h2 class="text-xl sm:text-2xl font-bold mb-4 text-amber-500">üìã Hist√≥rico de Atendimentos</h2>
            
            ${apts.length === 0 ? `
              <p class="text-center text-slate-400 py-8">Nenhum atendimento registrado</p>
            ` : `
              <div class="overflow-x-auto -mx-4 sm:mx-0">
                <div class="inline-block min-w-full align-middle">
                  <table class="w-full text-sm">
                    <thead>
                      <tr class="border-b border-zinc-800">
                        <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">Data/Hora</th>
                        <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">Profissional</th>
                        <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">Servi√ßo</th>
                        <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">Valor</th>
                        <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">Status</th>
                        <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">A√ß√µes</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${apts.map((a, idx) => `
                        <tr class="border-b border-zinc-800 hover:bg-zinc-800/50 transition">
                          <td class="py-3 px-2 whitespace-nowrap text-xs sm:text-sm">${a.date} ${a.time}</td>
                          <td class="py-3 px-2 whitespace-nowrap text-xs sm:text-sm">${a.professionalName}</td>
                          <td class="py-3 px-2 whitespace-nowrap text-xs sm:text-sm">${a.serviceName}</td>
                          <td class="py-3 px-2 text-amber-500 font-semibold whitespace-nowrap text-xs sm:text-sm">R$ ${a.value.toFixed(2)}</td>
                          <td class="py-3 px-2 whitespace-nowrap">
                            <span class="px-2 py-1 rounded text-xs ${
                              a.status === 'Pago' ? 'bg-emerald-600' : 'bg-yellow-600'
                            }">
                              ${a.status}
                            </span>
                          </td>
                          <td class="py-3 px-2 whitespace-nowrap">
                            <button onclick="confirmDeleteApt(${idx})" 
                              class="px-2 sm:px-3 py-1 bg-red-600 rounded-lg text-xs hover:bg-red-500 transition">
                              Excluir
                            </button>
                          </td>
                        </tr>
                      `).join('')}
                    </tbody>
                  </table>
                </div>
              </div>
            `}
          </div>
        </div>
      `;
    }

    function renderRelatorios() {
      const today = new Date();
      const year = String(today.getFullYear());
      const month = String(today.getMonth() + 1).padStart(2, '0');
      
      const todayStr = today.toISOString().split('T')[0];
      const todayApts = state.appointments.filter(a => a.date === todayStr);
      const monthApts = getAppointmentsByMonth(month, year);
      
      const todayRevenue = todayApts.reduce((s, a) => s + a.value, 0);
      const monthRevenue = calcMonthRevenue(month, year);
      const monthCosts = calcMonthCosts(month, year);
      
      const owner = state.professionals.find(p => p.commission === 0);
      const ownerTodayProfit = owner ? calcProfitForProfessional(owner, todayApts) : 0;
      const ownerMonthProfit = owner ? calcProfitForProfessional(owner, monthApts) - monthCosts : 0;

      return `
        <div class="p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6">
          ${owner ? `
            <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 border border-zinc-800">
              <h2 class="text-xl sm:text-2xl font-bold mb-4 text-amber-500">üëë Propriet√°rio</h2>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4">
                <div class="bg-black p-3 sm:p-4 rounded-lg border border-zinc-800">
                  <p class="text-zinc-400 text-xs sm:text-sm mb-1">Lucro Hoje</p>
                  <p class="text-xl sm:text-2xl font-bold text-amber-500">R$ ${ownerTodayProfit.toFixed(2)}</p>
                </div>
                <div class="bg-black p-3 sm:p-4 rounded-lg border border-zinc-800">
                  <p class="text-zinc-400 text-xs sm:text-sm mb-1">Lucro M√™s</p>
                  <p class="text-xl sm:text-2xl font-bold text-amber-500">R$ ${ownerMonthProfit.toFixed(2)}</p>
                </div>
                <div class="bg-black p-3 sm:p-4 rounded-lg border border-zinc-800">
                  <p class="text-zinc-400 text-xs sm:text-sm mb-1">Faturamento M√™s</p>
                  <p class="text-xl sm:text-2xl font-bold">R$ ${monthRevenue.toFixed(2)}</p>
                </div>
                <div class="bg-black p-3 sm:p-4 rounded-lg border border-zinc-800">
                  <p class="text-zinc-400 text-xs sm:text-sm mb-1">Custos M√™s</p>
                  <p class="text-xl sm:text-2xl font-bold text-red-400">R$ ${monthCosts.toFixed(2)}</p>
                </div>
              </div>
            </div>
          ` : ''}

          ${state.professionals.filter(p => p.commission > 0).length > 0 ? `
            <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 border border-zinc-800">
              <h2 class="text-xl sm:text-2xl font-bold mb-4 text-amber-500">üë• Colaboradores</h2>
              <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 sm:gap-4">
                ${state.professionals.filter(p => p.commission > 0).map(prof => {
                  const today = calcProfitForProfessional(prof, todayApts);
                  const month = calcProfitForProfessional(prof, monthApts);
                  return `
                    <div class="bg-black p-3 sm:p-4 rounded-lg border border-zinc-800">
                      <p class="font-bold mb-1 text-sm sm:text-base">${prof.name}</p>
                      <p class="text-xs sm:text-sm text-zinc-400">Comiss√£o: ${prof.commission}%</p>
                      <p class="text-base sm:text-lg text-amber-500 mt-2">Hoje: R$ ${today.toFixed(2)}</p>
                      <p class="text-base sm:text-lg text-amber-500">M√™s: R$ ${month.toFixed(2)}</p>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          ` : ''}

          <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 border border-zinc-800">
            <h2 class="text-xl sm:text-2xl font-bold mb-4 text-amber-500">üìä Estat√≠sticas do M√™s</h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
              <div class="bg-black p-3 sm:p-4 rounded-lg text-center border border-zinc-800">
                <p class="text-zinc-400 text-xs sm:text-sm mb-1">Total Servi√ßos</p>
                <p class="text-2xl sm:text-3xl font-bold text-amber-500">${monthApts.length}</p>
              </div>
              <div class="bg-black p-3 sm:p-4 rounded-lg text-center border border-zinc-800">
                <p class="text-zinc-400 text-xs sm:text-sm mb-1">Faturamento</p>
                <p class="text-2xl sm:text-3xl font-bold text-amber-500">R$ ${monthRevenue.toFixed(2)}</p>
              </div>
              <div class="bg-black p-3 sm:p-4 rounded-lg text-center border border-zinc-800">
                <p class="text-zinc-400 text-xs sm:text-sm mb-1">Ticket M√©dio</p>
                <p class="text-2xl sm:text-3xl font-bold text-amber-500">R$ ${monthApts.length > 0 ? (monthRevenue / monthApts.length).toFixed(2) : '0.00'}</p>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderExtrato() {
      return `
        <div class="p-3 sm:p-4 md:p-6">
          <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 border border-zinc-800">
            <h2 class="text-xl sm:text-2xl font-bold mb-4 text-amber-500">üíµ Extrato Mensal</h2>
            <div id="extrato-content">
              <p class="text-center text-zinc-400 py-8">Carregando...</p>
            </div>
          </div>
        </div>
      `;
    }

    function renderCustos() {
      const costs = [...state.costs].reverse();

      return `
        <div class="p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6">
          <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 border border-zinc-800">
            <h2 class="text-xl sm:text-2xl font-bold mb-4 text-amber-500">‚ûï Registrar Custo</h2>
            <form onsubmit="handleCostSubmit(event)" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4">
              <select name="category" required
                class="px-3 sm:px-4 py-2 text-sm sm:text-base bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none">
                <option value="">Categoria</option>
                <option value="Aluguel">Aluguel</option>
                <option value="Energia">Energia</option>
                <option value="√Ågua">√Ågua</option>
                <option value="Internet">Internet</option>
                <option value="Produtos">Produtos</option>
                <option value="Outros">Outros</option>
              </select>
              <input type="month" name="month" required
                class="px-3 sm:px-4 py-2 text-sm sm:text-base bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none">
              <input type="number" name="value" step="0.01" required placeholder="Valor"
                class="px-3 sm:px-4 py-2 text-sm sm:text-base bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none">
              <button type="submit" 
                class="px-4 sm:px-6 py-2 text-sm sm:text-base bg-amber-500 text-black rounded-lg font-bold hover:bg-amber-400 transition">
                SALVAR
              </button>
            </form>
          </div>

          <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 border border-zinc-800">
            <h2 class="text-xl sm:text-2xl font-bold mb-4 text-amber-500">üí∏ Hist√≥rico</h2>
            
            ${costs.length === 0 ? `
              <p class="text-center text-zinc-400 py-8">Nenhum custo registrado</p>
            ` : `
              <div class="overflow-x-auto -mx-4 sm:mx-0">
                <div class="inline-block min-w-full align-middle">
                  <table class="w-full text-sm">
                    <thead>
                      <tr class="border-b border-zinc-800">
                        <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">M√™s</th>
                        <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">Categoria</th>
                        <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">Valor</th>
                        <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">A√ß√µes</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${costs.map((c, idx) => `
                        <tr class="border-b border-zinc-800 hover:bg-zinc-800/50 transition">
                          <td class="py-3 px-2 whitespace-nowrap text-xs sm:text-sm">${c.month}</td>
                          <td class="py-3 px-2 whitespace-nowrap text-xs sm:text-sm">${c.category}</td>
                          <td class="py-3 px-2 text-red-400 font-semibold whitespace-nowrap text-xs sm:text-sm">R$ ${c.value.toFixed(2)}</td>
                          <td class="py-3 px-2 whitespace-nowrap">
                            <button onclick="confirmDeleteCost(${idx})" 
                              class="px-2 sm:px-3 py-1 bg-red-600 rounded-lg text-xs hover:bg-red-500 transition">
                              Excluir
                            </button>
                          </td>
                        </tr>
                      `).join('')}
                    </tbody>
                  </table>
                </div>
              </div>
            `}
          </div>
        </div>
      `;
    }

    function renderServicos() {
      return `
        <div class="p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6">
          <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 border border-zinc-800">
            <h2 class="text-xl sm:text-2xl font-bold mb-4 text-amber-500">‚úÇÔ∏è Servi√ßos Cadastrados</h2>
            
            ${state.services.length === 0 ? `
              <p class="text-center text-zinc-400 py-8">Nenhum servi√ßo cadastrado</p>
            ` : `
              <div class="space-y-2">
                ${state.services.map((s, idx) => `
                  <div class="bg-black p-3 sm:p-4 rounded-lg border border-zinc-800 hover:bg-zinc-900 transition flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
                    <div class="flex-1">
                      <p class="font-bold text-sm sm:text-base">${s.name}</p>
                      <p class="text-amber-500 text-sm sm:text-base">R$ ${s.price.toFixed(2)}</p>
                    </div>
                    <div class="flex gap-2 w-full sm:w-auto">
                      <button onclick="editService(${idx})" 
                        class="flex-1 sm:flex-none px-3 py-1 bg-blue-600 rounded-lg text-xs sm:text-sm hover:bg-blue-500 transition">
                        Editar
                      </button>
                      <button onclick="confirmDeleteSvc(${idx})" 
                        class="flex-1 sm:flex-none px-3 py-1 bg-red-600 rounded-lg text-xs sm:text-sm hover:bg-red-500 transition">
                        Excluir
                      </button>
                    </div>
                  </div>
                `).join('')}
              </div>
            `}
          </div>

          <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 border border-zinc-800">
            <h2 class="text-xl sm:text-2xl font-bold mb-4 text-amber-500">‚öôÔ∏è Configura√ß√µes</h2>
            <form onsubmit="handleConfigSubmit(event)" class="space-y-3 sm:space-y-4">
              <div>
                <label class="block text-xs sm:text-sm font-semibold mb-1">Nome da Barbearia</label>
                <input type="text" name="businessName" value="${state.config.businessName}" required
                  class="w-full px-3 sm:px-4 py-2 text-sm sm:text-base bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none">
              </div>
              <div>
                <label class="block text-xs sm:text-sm font-semibold mb-1">CNPJ</label>
                <input type="text" name="cnpj" value="${state.config.cnpj}" placeholder="00.000.000/0000-00"
                  class="w-full px-3 sm:px-4 py-2 text-sm sm:text-base bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none">
              </div>
              <button type="submit" 
                class="w-full sm:w-auto px-4 sm:px-6 py-2.5 sm:py-3 text-sm sm:text-base bg-amber-500 text-black rounded-lg font-bold hover:bg-amber-400 transition">
                SALVAR
              </button>
            </form>
          </div>
        </div>
      `;
    }

    function renderProfissionais() {
      const owner = state.professionals.find(p => p.commission === 0);
      
      return `
        <div class="p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6">
          <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 border border-zinc-800">
            <h2 class="text-xl sm:text-2xl font-bold mb-4 text-amber-500">üëë Propriet√°rio</h2>
            ${owner ? `
              <form onsubmit="handleUpdateOwner(event)" class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                <input type="text" name="ownerName" value="${owner.name}" required placeholder="Nome do Propriet√°rio"
                  class="px-3 sm:px-4 py-2 text-sm sm:text-base bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none">
                <button type="submit" 
                  class="px-4 sm:px-6 py-2 text-sm sm:text-base bg-amber-500 text-black rounded-lg font-bold hover:bg-amber-400 transition">
                  ATUALIZAR NOME
                </button>
              </form>
            ` : `
              <form onsubmit="handleCreateOwner(event)" class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                <input type="text" name="ownerName" required placeholder="Nome do Propriet√°rio"
                  class="px-3 sm:px-4 py-2 text-sm sm:text-base bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none">
                <button type="submit" 
                  class="px-4 sm:px-6 py-2 text-sm sm:text-base bg-amber-500 text-black rounded-lg font-bold hover:bg-amber-400 transition">
                  CADASTRAR PROPRIET√ÅRIO
                </button>
              </form>
            `}
          </div>

          <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 border border-zinc-800">
            <h2 class="text-xl sm:text-2xl font-bold mb-4 text-amber-500">‚ûï Cadastrar Colaborador</h2>
            <form onsubmit="handleProfessionalSubmit(event)" class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
              <input type="text" name="name" required placeholder="Nome"
                class="px-3 sm:px-4 py-2 text-sm sm:text-base bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none">
              <input type="number" name="commission" min="1" max="100" required placeholder="Comiss√£o %"
                class="px-3 sm:px-4 py-2 text-sm sm:text-base bg-black rounded-lg border border-zinc-800 focus:border-amber-500 outline-none">
              <button type="submit" 
                class="px-4 sm:px-6 py-2 text-sm sm:text-base bg-amber-500 text-black rounded-lg font-bold hover:bg-amber-400 transition">
                CADASTRAR
              </button>
            </form>
          </div>

          <div class="bg-zinc-900 rounded-xl p-4 sm:p-6 border border-zinc-800">
            <h2 class="text-xl sm:text-2xl font-bold mb-4 text-amber-500">üë• Colaboradores</h2>
            
            ${state.professionals.length === 0 ? `
              <p class="text-center text-zinc-400 py-8">Nenhum profissional cadastrado</p>
            ` : `
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4">
                ${state.professionals.map((p, idx) => `
                  <div class="bg-black p-3 sm:p-4 rounded-lg border border-zinc-800">
                    <div class="flex items-start justify-between mb-2 gap-2">
                      <div class="flex-1 min-w-0">
                        <p class="font-bold text-base sm:text-lg truncate">${p.name}</p>
                        <p class="text-amber-500 text-sm sm:text-base">Comiss√£o: ${p.commission}%</p>
                      </div>
                      ${p.commission === 0 ? `
                        <span class="px-2 sm:px-3 py-1 bg-amber-500 text-black rounded-lg text-xs font-bold whitespace-nowrap">
                          PROPRIET√ÅRIO
                        </span>
                      ` : `
                        <button onclick="confirmDeletePro(${idx})" 
                          class="px-2 sm:px-3 py-1 bg-red-600 rounded-lg text-xs sm:text-sm hover:bg-red-500 transition whitespace-nowrap">
                          Excluir
                        </button>
                      `}
                    </div>
                    <p class="text-xs sm:text-sm text-zinc-400">
                      ${p.commission === 0 
                        ? '100% seus atendimentos + 50% dos demais' 
                        : `Recebe ${p.commission}% por atendimento`
                      }
                    </p>
                  </div>
                `).join('')}
              </div>
            `}
          </div>
        </div>
      `;
    }

    function renderApp() {
      const root = document.getElementById('root');
      
      if (!state.isAuthenticated) {
        root.innerHTML = renderLogin();
        return;
      }

      let content = '';
      switch(state.currentView) {
        case 'caixa': content = renderCaixa(); break;
        case 'historico': content = renderHistorico(); break;
        case 'relatorios': content = renderRelatorios(); break;
        case 'extrato': content = renderExtrato(); break;
        case 'custos': content = renderCustos(); break;
        case 'servicos': content = renderServicos(); break;
        case 'profissionais': content = renderProfissionais(); break;
      }
      
      root.innerHTML = renderNav() + content;
      
      if (state.currentView === 'extrato') {
        setTimeout(renderExtratoContent, 50);
      }
    }

    function renderExtratoContent() {
      const container = document.getElementById('extrato-content');
      if (!container) return;
      
      const today = new Date();
      const year = String(today.getFullYear());
      const month = String(today.getMonth() + 1).padStart(2, '0');
      
      const monthApts = getAppointmentsByMonth(month, year);
      const total = monthApts.reduce((s, a) => s + a.value, 0);
      
      container.innerHTML = `
        <div class="mb-4 sm:mb-6">
          <div class="bg-black p-3 sm:p-4 rounded-lg border border-zinc-800">
            <p class="text-zinc-400 text-xs sm:text-sm mb-1">Total do M√™s</p>
            <p class="text-2xl sm:text-3xl font-bold text-amber-500">R$ ${total.toFixed(2)}</p>
            <p class="text-xs sm:text-sm text-zinc-400 mt-1">${monthApts.length} atendimentos</p>
          </div>
        </div>
        
        ${monthApts.length === 0 ? `
          <p class="text-center text-zinc-400 py-8">Nenhum atendimento este m√™s</p>
        ` : `
          <div class="overflow-x-auto -mx-4 sm:mx-0">
            <div class="inline-block min-w-full align-middle">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-zinc-800">
                    <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">Data</th>
                    <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">Profissional</th>
                    <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">Servi√ßo</th>
                    <th class="text-left py-3 px-2 font-semibold whitespace-nowrap">Valor</th>
                  </tr>
                </thead>
                <tbody>
                  ${monthApts.map(a => `
                    <tr class="border-b border-zinc-800 hover:bg-zinc-800/50 transition">
                      <td class="py-3 px-2 whitespace-nowrap text-xs sm:text-sm">${a.date}</td>
                      <td class="py-3 px-2 whitespace-nowrap text-xs sm:text-sm">${a.professionalName}</td>
                      <td class="py-3 px-2 whitespace-nowrap text-xs sm:text-sm">${a.serviceName}</td>
                      <td class="py-3 px-2 text-amber-500 font-semibold whitespace-nowrap text-xs sm:text-sm">R$ ${a.value.toFixed(2)}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        `}
      `;
    }

    // INICIAR
    init();
    renderApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bade9df64318dd8',t:'MTc2Nzg5ODU3Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

